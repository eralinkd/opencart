{{ header }}{{ column_left }}
<div id="content">
  <div class="page-header">
    <div class="container-fluid">
      <div class="float-end">
        <button type="submit" form="form-product" data-bs-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary btn-lg"><i class="fa-solid fa-floppy-disk"></i> Save Product</button>
        <a href="{{ back }}" data-bs-toggle="tooltip" title="{{ button_back }}" class="btn btn-light btn-lg"><i class="fa-solid fa-reply"></i> Back</a>
      </div>
      <h1>{{ heading_title }}</h1>
      <ol class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
          <li class="breadcrumb-item"><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
      </ol>
    </div>
  </div>
  <div class="container-fluid">
    {% if master_id %}
      <div class="alert alert-warning"><i class="fa-solid fa-circle-exclamation"></i> {{ text_variant }}</div>
    {% endif %}
    <div class="card product-form-card">
      <div class="card-header">
        <h2 class="mb-0"><i class="fa-solid fa-pencil"></i> {{ text_form }}</h2>
      </div>
      <div class="card-body">
        <form id="form-product" action="{{ save }}" method="post" data-oc-toggle="ajax">
          <ul class="nav nav-tabs product-form-tabs">
            <li class="nav-item"><a href="#tab-general" data-bs-toggle="tab" class="nav-link active"><i class="fa-solid fa-file-lines"></i> General Information</a></li>
            <li class="nav-item"><a href="#tab-data" data-bs-toggle="tab" class="nav-link"><i class="fa-solid fa-dollar-sign"></i> Price & Stock</a></li>
            <li class="nav-item"><a href="#tab-image" data-bs-toggle="tab" class="nav-link"><i class="fa-solid fa-image"></i> Images</a></li>
          </ul>
          <div class="tab-content product-form-content">
            <div class="tab-pane active" id="tab-general">
              <div class="form-section">
                <ul class="nav nav-tabs language-tabs">
                  {% for language in languages %}
                    <li class="nav-item"><a href="#language-{{ language.language_id }}" data-bs-toggle="tab" class="nav-link{% if loop.first %} active{% endif %}"><img src="{{ language.image }}" title="{{ language.name }}"/> {{ language.name }}</a></li>
                  {% endfor %}
                </ul>
                <div class="tab-content language-content">
                  {% for language in languages %}
                    <div id="language-{{ language.language_id }}" class="tab-pane{% if loop.first %} active{% endif %}">
                      <div class="form-field-group">
                        <label for="input-name-{{ language.language_id }}" class="form-label required">
                          <i class="fa-solid fa-tag"></i> Product Name
                          <span class="text-danger">*</span>
                        </label>
                        <input type="text" name="product_description[{{ language.language_id }}][name]" value="{{ product_description[language.language_id] ? product_description[language.language_id].name }}" placeholder="Enter product name" id="input-name-{{ language.language_id }}" class="form-control form-control-lg"/>
                        <div class="form-help">Enter the product name. This will be displayed on the product page and in product listings.</div>
                        <div id="error-name-{{ language.language_id }}" class="invalid-feedback"></div>
                      </div>
                      <div class="form-field-group">
                        <label for="input-description-{{ language.language_id }}" class="form-label">
                          <i class="fa-solid fa-align-left"></i> Description
                        </label>
                        <div class="description-wrapper">
                          <textarea name="product_description[{{ language.language_id }}][description]" placeholder="Enter product description" id="input-description-{{ language.language_id }}" data-oc-toggle="ckeditor" data-lang="{{ ckeditor }}" class="form-control description-textarea" rows="12">{{ product_description[language.language_id] ? product_description[language.language_id].description }}</textarea>
                        </div>
                        <div class="form-help">Enter a detailed description of the product. Include features, specifications, and any important information customers should know.</div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
            <div id="tab-data" class="tab-pane">
              <input type="hidden" name="master_id" value="{{ master_id }}"/>
              <div class="form-section">
                <div class="form-grid">
                  <div class="form-field-group">
                    <label for="input-price" class="form-label required">
                      <i class="fa-solid fa-dollar-sign"></i> Price
                      <span class="text-muted">(per unit)</span>
                    </label>
                    <div class="input-with-icon">
                      <span class="input-icon">$</span>
                      <input type="text" name="price" value="{{ price }}" placeholder="0.00" id="input-price" class="form-control form-control-lg"/>
                    </div>
                    <div class="form-help">Enter the product price per unit. Use decimal format (e.g., 99.99).</div>
                  </div>
                  <div class="form-field-group">
                    <label for="input-quantity" class="form-label required">
                      <i class="fa-solid fa-boxes-stacked"></i> Quantity in Stock
                    </label>
                    <input type="number" name="quantity" value="{{ quantity }}" placeholder="0" id="input-quantity" class="form-control form-control-lg" min="0"/>
                    <div class="form-help">Enter the number of items available in stock. Set to 0 if out of stock.</div>
                  </div>
                </div>
                <div class="form-field-group status-field">
                  <label class="form-label">
                    <i class="fa-solid fa-toggle-on"></i> Product Status
                  </label>
                  <div class="status-switch-wrapper">
                    <div class="form-check form-switch form-switch-custom">
                      <input type="hidden" name="status" value="0"/> 
                      <input type="checkbox" name="status" value="1" id="input-status" class="form-check-input"{% if status %} checked{% endif %}/>
                      <label for="input-status" class="form-check-label">
                        <span class="status-label-text">
                          {% if status %}
                            <span class="status-enabled"><i class="fa-solid fa-check-circle"></i> Enabled</span>
                            <span class="status-description">Product is visible in store</span>
                          {% else %}
                            <span class="status-disabled"><i class="fa-solid fa-times-circle"></i> Disabled</span>
                            <span class="status-description">Product is hidden from store</span>
                          {% endif %}
                        </span>
                      </label>
                    </div>
                  </div>
                  <div class="form-help">Enable or disable the product. Disabled products are not visible to customers.</div>
                </div>
              </div>
            </div>
            <div id="tab-image" class="tab-pane">
              <div class="form-section">
                <div class="form-field-group">
                  <label class="form-label">
                    <i class="fa-solid fa-image"></i> Main Product Image
                  </label>
                  <div class="image-upload-wrapper">
                    <div id="image" class="image-preview-card">
                      <div class="image-preview">
                        <img src="{{ thumb }}" alt="" title="" id="thumb-image" data-oc-placeholder="{{ placeholder }}" class="preview-img"/> 
                        <input type="hidden" name="image" value="{{ image }}" id="input-image"/>
                        <div class="image-overlay">
                          <button type="button" data-oc-toggle="image" data-oc-target="#input-image" data-oc-thumb="#thumb-image" class="btn btn-primary btn-sm"><i class="fa-solid fa-upload"></i> Change</button>
                          <button type="button" data-oc-toggle="clear" data-oc-target="#input-image" data-oc-thumb="#thumb-image" class="btn btn-danger btn-sm"><i class="fa-regular fa-trash-can"></i> Remove</button>
                        </div>
                      </div>
                    </div>
                    <div class="form-help">Upload the main product image. This will be displayed as the primary product image.</div>
                  </div>
                </div>
                <div class="form-field-group">
                  <label class="form-label">
                    <i class="fa-solid fa-images"></i> Additional Product Images
                  </label>
                  <div class="additional-images-grid" id="product-image-grid">
                    {% set image_row = 0 %}
                    {% for product_image in product_images %}
                      <div class="image-item-card" id="product-image-row-{{ image_row }}">
                        <div class="image-item-preview">
                          <img src="{{ product_image.thumb }}" alt="" title="" id="product-image-{{ image_row }}" data-oc-placeholder="{{ placeholder }}" class="preview-img"/> 
                          <input type="hidden" name="product_image[{{ image_row }}][image]" value="{{ product_image.image }}" id="input-product-image-{{ image_row }}"/>
                          <div class="image-item-overlay">
                            <button type="button" data-oc-toggle="image" data-oc-target="#input-product-image-{{ image_row }}" data-oc-thumb="#product-image-{{ image_row }}" class="btn btn-primary btn-sm"><i class="fa-solid fa-upload"></i></button>
                            <button type="button" data-oc-toggle="clear" data-oc-target="#input-product-image-{{ image_row }}" data-oc-thumb="#product-image-{{ image_row }}" class="btn btn-danger btn-sm"><i class="fa-regular fa-trash-can"></i></button>
                          </div>
                        </div>
                        <div class="image-item-controls">
                          <input type="number" name="product_image[{{ image_row }}][sort_order]" value="{{ product_image.sort_order }}" placeholder="Sort order" class="form-control form-control-sm" min="0"/>
                          <button type="button" onclick="$('#product-image-row-{{ image_row }}').remove();" class="btn btn-danger btn-sm"><i class="fa-solid fa-trash"></i></button>
                        </div>
                      </div>
                      {% set image_row = image_row + 1 %}
                    {% endfor %}
                  </div>
                  <button type="button" id="button-image" class="btn btn-outline-primary mt-3"><i class="fa-solid fa-plus"></i> Add Image</button>
                  <div class="form-help">Add additional product images. These will be shown in the product gallery.</div>
                </div>
              </div>
            </div>
          </div>
          <input type="hidden" name="product_id" value="{{ product_id }}" id="input-product-id"/>
          <input type="hidden" name="user_token" value="{{ user_token }}" id="input-user-token"/>
        </form>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript"><!--
var image_row = {{ image_row }};

$('#button-image').on('click', function() {
    html = '<div class="image-item-card" id="product-image-row-' + image_row + '">';
    html += '  <div class="image-item-preview">';
    html += '    <img src="{{ placeholder }}" alt="" title="" id="product-image-' + image_row + '" data-oc-placeholder="{{ placeholder }}" class="preview-img"/>';
    html += '    <input type="hidden" name="product_image[' + image_row + '][image]" value="" id="input-product-image-' + image_row + '"/>';
    html += '    <div class="image-item-overlay">';
    html += '      <button type="button" data-oc-toggle="image" data-oc-target="#input-product-image-' + image_row + '" data-oc-thumb="#product-image-' + image_row + '" class="btn btn-primary btn-sm"><i class="fa-solid fa-upload"></i></button>';
    html += '      <button type="button" data-oc-toggle="clear" data-oc-target="#input-product-image-' + image_row + '" data-oc-thumb="#product-image-' + image_row + '" class="btn btn-danger btn-sm"><i class="fa-regular fa-trash-can"></i></button>';
    html += '    </div>';
    html += '  </div>';
    html += '  <div class="image-item-controls">';
    html += '    <input type="number" name="product_image[' + image_row + '][sort_order]" value="" placeholder="Sort order" class="form-control form-control-sm" min="0"/>';
    html += '    <button type="button" onclick="$(\'#product-image-row-' + image_row + '\').remove();" class="btn btn-danger btn-sm"><i class="fa-solid fa-trash"></i></button>';
    html += '  </div>';
    html += '</div>';

    $('#product-image-grid').append(html);

    image_row++;
});

// Update status label on change
$('#input-status').on('change', function() {
    var $label = $(this).next('label');
    if ($(this).is(':checked')) {
        $label.html('<span class="status-label-text"><span class="status-enabled"><i class="fa-solid fa-check-circle"></i> Enabled</span><span class="status-description">Product is visible in store</span></span>');
    } else {
        $label.html('<span class="status-label-text"><span class="status-disabled"><i class="fa-solid fa-times-circle"></i> Disabled</span><span class="status-description">Product is hidden from store</span></span>');
    }
});
//--></script>
{{ filemanager }}
{{ footer }}
